{
    "collab_server" : "",
    "contents" : "\n#run data_prep.R first\n\nlibrary(cluster) #for calculating gower distance\nlibrary(klaR)  #for running kmodes analysis\nlibrary(nomclust)\nlibrary(blockcluster)\nlibrary(data.table)\nlibrary(reshape)\nlibrary(xtable)\n\n##Clustering with mixed data types \nround(apply(ClusterData, 2, count_NAs), 2)\ndataSET <- ClusterData[,c(\"min_depth\",\"max_depth\",\"maxLength\",\"Temp_type\",\n                      \"Vertical_Habitat\", \"Horizontal_Habitat\",\n                      \"Pelvic_finPosition\", \"Caudal_finShape\",\n                      \"Dorsal_finShape\",\"Physical_protection\",\n                      \"Barbel_presence\",\"Swimming_mode\",\"Body_form\",\n                      \"Eye_position\",\"Oral_gapePosition\",\"Reproductive_strategy\",\n                      \"Sexual_differentation\",\"Parental_care\",\n                      \"Vulnerability\")]\ndistanceMethod <- \"gower\"\n\n#build a similarity/dissimilarity matrix\ndissMatrix   <- daisy(dataSET, metric = c(distanceMethod), stand = FALSE)\n\n#select number of clusters from sil_width\nk <- 9\n#define options for clustering \nmethodsClust <- c(\"ward.D\", \"ward.D2\", \"single\", \"complete\", \n                  \"average\", \"mcquitty\", \"median\", \"centroid\")\n\n##NULL dataset for the output\ndistance_output <- c(1:k)\nload(\"data/comparison.RData\")\n\n#run through all options for clustering and produce dendograms\n#and group associations\nfor (i in 1:length(methodsClust)){\n  Cmethod <- methodsClust[i]\n  \n  final_fit <- hclust(dissMatrix, method = Cmethod)\n  \n  ###plot the dendogram\n  clust <- cutree(final_fit,k=k)  # k clusters\n  \n  plotIT <- ggdendPlot(dissMatrix, final_fit, k, clust, dataSET[,1:19])\n  ggsave(paste0(\"documents/figures/dendogram/dist=\",\"missing\",\",clust=\",Cmethod,\".png\"),plotIT,\n         height = 25, width = 19, units = \"cm\")\n  \n  ##explore the group fits\n  dataSET$groups <- clust\n  setnames(dataSET, \"groups\", Cmethod)\n  \n  \n  hclust_output <- hclust_results(dataSET, 1:19, clust)\n  setnames(hclust_output, \"the_summary\", Cmethod)\n  distance_output <- cbind(distance_output, hclust_output)\n  \n  cor.matrix <- as.matrix(dist(clust,method = \"manhattan\"))\n  m2 <- melt(cor.matrix)[melt(upper.tri(cor.matrix))$value,]\n  m2$value<-ifelse(m2$value==0,1,0)\n  names(m2) <- c(\"c1\", \"c2\", Cmethod)\n  comparison <- merge(comparison,m2,by=c(\"c1\",\"c2\"))\n}\n\nsave(comparison,file=\"output/missing_comparison.RData\")\nsave(distance_output,file = \"output/missingDistance_ouptut.RData\")\n\n\n##analyse and interpret output\nmissing <- comparison\nload(\"output/gowerDist_comparison.RData\")  \ncomparison <- cbind(comparison, missing[, 3:10])\ncolnames(comparison) <- c(\"species1\",\"species2\",\"ward.D\", \"ward.D2\", \n                          \"single\", \"complete\", \"average\", \"mcquitty\", \n                          \"median\", \"centroid\",\"Mward.D\", \"Mward.D2\", \n                          \"Msingle\", \"Mcomplete\", \"Maverage\", \"Mmcquitty\", \n                          \"Mmedian\", \"Mcentroid\")\n#adjusted Rand index\n  randIndexij <- comparison[,3:18]\n  n <- ncol(randIndexij)\n  \n  randIndex <- matrix(0,n,n)\n  \n  for ( i in 1:n)\n  {\n    for (j in i:n)\n    {\n      randIndex[i,j] <- adjustedRandIndex(randIndexij[,i],randIndexij[,j])\n    }\n  }\n  \n  randIndex <- t(randIndex)\n  \n  randIndex <- data.frame(randIndex, row.names = c(\"ward.D\", \"ward.D2\", \n                                                   \"single\", \"complete\", \"average\", \"mcquitty\", \n                                                   \"median\", \"centroid\",\"Mward.D\", \"Mward.D2\", \n                                                   \"Msingle\", \"Mcomplete\", \"Maverage\", \"Mmcquitty\", \n                                                   \"Mmedian\", \"Mcentroid\"))\n  colnames(randIndex) <- c(\"ward.D\", \"ward.D2\", \n                           \"single\", \"complete\", \"average\", \"mcquitty\", \n                           \"median\", \"centroid\",\"Mward.D\", \"Mward.D2\", \n                           \"Msingle\", \"Mcomplete\", \"Maverage\", \"Mmcquitty\", \n                           \"Mmedian\", \"Mcentroid\")\n  \n  missIndexij <- xtable(randIndex[9:16,1:8], digits = 3,\n                        caption = \"Adjusted rand index value indicating \n                        similarity between clustering methods with all \n                        variables and with missing variable removed\")\n  #randIndexij <-  printbold(randIndexij, randIndexij>0.6&randIndexij<1)\n\n  print(missIndexij, file = \"documents/tables/missingRandIndex.tex\")\n  \n  ###Missing data imputation\n  \n  ClusterData <- fishes[,c(\"Feeding_mode\", \"min_depth\", \"max_depth\",\n                           \"Temp_type\",\"Vertical_Habitat\",\"Horizontal_Habitat\",\n                           #      \"Estuarine_use\",\"Preferred_temp\",\n                           \"Pelvic_finPosition\",\"Caudal_finShape\",\"Dorsal_Type\",\n                           \"Physical_protection\",\"Chemical_defence\",\"Barbel_presence\",\n                           \"Swimming_mode\",\"Body_form\",\"Eye_position\",\"Oral_gapePosition\",\n                           #      \"Spine\",\"Teeth_shape\",\n                           \"Max_weight\",\"maxLength\", \"Common_Length\",\n                           #      \"a\", \"b\", \"K\", \"t0\",\"MaxAge\",\"Mortality\",\n                           \"Reproductive_Season\",\"Reproductive_strategy\",\n                           #      \"Vertical_migration\",\"Number_spawnsYer\",\n                           \"Sexual_differentation\",\"Migration\",\n                           \"Reproduction_location\",\"Parental_care\",\n                           #      \"Length_maturity\",\"Age_maturation\",\"Number_eggs\",\n                           #      \"vulnerability\",\"Phylogenetic_diversity\",\n                           \"Shooling_type\",\"pop_double\")]\n  \n  \n  cluster.imp <- missForest(ClusterData)\n  \n  ClusterImp <- cluster.imp$ximp\n  \n  fishes$FeedMode <- ClusterImp$Feeding_mode\n  write.csv(fishes, \"output/missingDataTest.csv\")\n  ",
    "created" : 1495518270889.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3884812756",
    "id" : "B68B67E0",
    "lastKnownWriteTime" : 1495570119,
    "last_content_update" : 1495570119779,
    "path" : "C:/Users/miree/OneDrive/OneDrive - Victoria University of Wellington - STAFF/TropicGroupClassification/R/missing_dataAnalysis.R",
    "project_path" : "R/missing_dataAnalysis.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}