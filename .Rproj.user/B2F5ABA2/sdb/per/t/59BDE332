{
    "collab_server" : "",
    "contents" : "rm(list = ls())\n#source(\"R/parallelCVxgb.r\")  ##for running GBM\nsource(\"R/functions.r\")\n\n#library(caret)  #for random forests and supervised ML output\n#library(e1071)\n#library(HDclassif)\n#library(PerformanceAnalytics)\n#library(factoextra)\n\nlibrary(dplyr)  #for data cleaning\n#library(fpc) #flexible processes for clustering\n#library(vegan)\n#library(ecodist)\nlibrary(caret)  ## create a full set of dummy variables (binary categorical variables)\n\n  #read in data\n  fishes <- read.csv(\"data/fishes.csv\", na.strings = c(\"\",\"NA\"))\n  row.names(fishes) <- fishes$CommonName\n\n#check the completenesss of the data i.e. how many missing? \n#>10% of cases missing don't include\n\n#split into integer and factor variables\n\n#first factor variables\nis.fact <- sapply(fishes, is.factor)\nfishes_fact <- fishes[, is.fact]\n\nround(apply(fishes_fact, 2, count_NAs), 2)\n\n#second numerical values\nfishes_num <- fishes[, !is.fact]\n\nround(apply(fishes_num, 2, count_NAs), 2)\n\n##choose variables to cluster species by\n##including all variables with less than 20% missing\n#Raw data\nClusterData <- fishes[,c(\"min_depth\", \"max_depth\",\n                         \"Temp_type\",\"Vertical_Habitat\",\"Horizontal_Habitat\",\n                         #\"Estuarine_use\",\"Preferred_temp\",\n                         \"Pelvic_finPosition\",\"Caudal_finShape\",\"Dorsal_finShape\",\n                         \"Physical_protection\",\"Barbel_presence\",\n                         #\"Chemical_defence\",\n                         \"Swimming_mode\",\"Body_form\",\"Eye_position\",\n                         \"Oral_gapePosition\",\"Spine\",\n                         #\"Teeth_shape\",\"Max_weight\",\"Common_Length\",\n                         \"maxLength\", \n                         #\"a\", \"b\", \"K\", \"t0\",\"MaxAge\",\"Mortality\",\n                         #\"Reproductive_Season\",\n                         \"Reproductive_strategy\",\"Egg_attach\",\n                         #\"Vertical_migration\",\"Number_spawnsYer\",\n                         \"Sexual_differentation\",\"Migration\",\n                         \"Reproduction_location\",\"Parental_care\",\n                         #\"Length_maturity\",\"Age_maturation\",\"Number_eggs\",\n                         #\"Phylogenetic_diversity\",\n                         \"Vulnerability\",\"Shooling_type\",\"pop_double\")]\n\n\n##explore the numerical data\n#What needs to be scaled/transformed/normalised?\n\n  #Minimum depth\n    hist(fishes$min_depth) ##needs to be scaled\n  #scale the min depth variable\n    fishes$minDepth_s <- scaled(fishes$min_depth)\n      hist(fishes$minDepth_s) \n  #transform the min depth variable\n    fishes$minDepth_log <- normalised(fishes$min_depth)\n      hist(fishes$minDepth_log)\n\n      #change inf to 0\n      fishes$minDepth_log[is.infinite(fishes$minDepth_log)] <- 0\n      \n      \n      \n  #maximum depth\n    hist(fishes$max_depth) ##needs to be scaled\n  ##scale the max depth variable\n    #log scale - transform/normalise the data\n      fishes$maxDepth_log <- normalised(fishes$max_depth)\n        hist(fishes$maxDepth_log)\n    #scale between 0 and one with no change to the distribution\n      fishes$maxDepth_s <- scaled(fishes$max_depth)\n        hist(fishes$maxDepth_s)\n    \n\n\n    #maximum weight\n      hist(fishes[!fishes$Max_weight==0,]$Max_weight) ##needs to be scaled\n      \n      ##might need to remove sunfish?##\n    \n    ##scale the max weight variable\n    #log scale - normalise the data\n      fishes$maxWeight_log <- normalised(fishes$Max_weight)\n        hist(fishes$maxWeight_log)\n    #scale between 0 and one with no change to the distribution\n      fishes$maxWeight_s <- scaled(fishes$Max_weight)\n        hist(fishes$maxWeight_s)\n\n        fishes$maxWeight_log[is.infinite(fishes$maxWeight_log)] <- NA\n        \n    #preferred temperature - include with more data...\n        \n      hist(fishes$Preferred_temp)  #check temps >20 - not currently using variable\n    #scale between 0 and one with no change to the distribution\n\n      \n    #Mortality rate - include with more data...\n      hist(fishes$Mortality)  ##chec)k mortality >0.8\n    \n      \n    #Maximum age -include with more data...\n      hist(fishes$MaxAge) #not normal, better distribution but sill needs to be scaled\n\n      \n    #Common length\n      hist(fishes$Common_Length) #if using needs to be scaled\n    #log scale - normalise the data\n      fishes$commonLength_log <- normalised(fishes$Common_Length)\n      hist(fishes$commonLength_log)\n    #scale between 0 and one with no change to the distribution\n      fishes$commonLength_s <- scaled(fishes$Common_Length)\n      hist(fishes$commonLength_s)\n      \n    #Max length\n      hist(fishes$maxLength)  ##needs to be scaled\n      \n    #log scale - normalise the data\n      fishes$maxLength_log <- normalised(fishes$maxLength)\n        hist(fishes$maxLength_log)\n        \n    #scale between 0 and one with no change to the distribution\n      fishes$maxLength_s <- scaled(fishes$maxLength)\n        hist(fishes$maxLength_s)\n\n\n\n###create columns for categorical variables\n        #make numerical data categorical\n        hist(fishes[!fishes$CommonName==\"Sunfish\",]$Max_weight)\n        fishes$SizeCat <- cut(fishes$Max_weight,\n                              breaks = c(-Inf, 100, 1000, 10000, Inf),\n                              labels = c(\"Very small\", \"Small\", \"Medium\", \"Large\"))\n        fishes$LengthCat <- cut(fishes$maxLength,\n                                breaks = c(-Inf, 30, 60, 90, Inf),\n                                labels = c(\"Very small\", \"Small\", \"Medium\", \"Large\"))\n        fishes$DiverseCat <- cut(fishes$Phylogenetic_diversity,\n                                breaks = c(-Inf, 0.55, 0.7, 0.85, Inf),\n                                labels = c(\"Low\", \"Medium\", \"High\", \"Very high\"))\n        fishes$VulnerCat <- cut(fishes$Vulnerability,\n                                 breaks = c(-Inf, 25, 50, 75, Inf),\n                                 labels = c(\"Low\", \"Medium\", \"High\", \"Very high\"))\n        fishes$DepthCat <- cut(fishes$max_depth,\n                                breaks = c(-Inf, 250, 500, 1000, Inf),\n                                labels = c(\"Shallow\", \"Medium\", \"Deep\", \"Very deep\"))\n        \n        ##make a dummy matrix\n        DUMdata <- fishes[,c(\"SizeCat\",\"LengthCat\",\"DiverseCat\", \"VulnerCat\",\n                         \"Temp_type\",\"Vertical_Habitat\",\"Horizontal_Habitat\",\"DepthCat\",\n                         \"Pelvic_finPosition\",\"Caudal_finShape\",\"Dorsal_finShape\",\n                         \"Physical_protection\",\"Chemical_defence\",\"Barbel_presence\",\n                         \"Swimming_mode\",\"Body_form\",\"Eye_position\",\"Oral_gapePosition\",\n                         \"Reproductive_Season\",\"Reproductive_strategy\",\n                         \"Sexual_differentation\",\"Migration\",\n                         \"Reproduction_location\",\"Parental_care\",\n                         \"Shooling_type\",\"pop_double\")]\n       \n        dmy <- dummyVars(\" ~ .\", data = DUMdata, fullRank=T)\n        dummyFish <- (predict(dmy, newdata = DUMdata))\n               \n\n#with standardised data\nClusterData_s <- fishes[,c(\"Temp_type\", \"Vertical_Habitat\", \"Horizontal_Habitat\", \n                        \"minDepth_s\", \"maxDepth_s\", \"maxWeight_s\",  \n                        \"commonLength_s\",\"maxLength_s\",\n                        \"Pelvic_finPosition\", \"Caudal_finShape\", \"Dorsal_Type\",\n                        \"Physical_protection\", \"Chemical_defence\",\"Barbel_presence\",\n                        \"Swimming_mode\",\"Eye_position\",\"Oral_gapePosition\", \n                        \"Body_form\",\"Reproductive_strategy\",\n                        \"Migration\",\"Reproduction_location\",\n                        \"Sexual_differentation\", \"Parental_care\", \n                        \"Shooling_type\",\"pop_double\")]\n\n#logged data\nClusterData_log <- fishes[,c(\"minDepth_log\",\"maxDepth_log\",\n                             \"Temp_type\",\"Vertical_Habitat\",\"Horizontal_Habitat\",\n                             \"Pelvic_finPosition\",\"Caudal_finShape\",\"Dorsal_Type\",\n                             \"Physical_protection\",\"Chemical_defence\",\"Barbel_presence\",\n                             \"Swimming_mode\",\"Body_form\",\"Eye_position\",\"Oral_gapePosition\",\n                             \"maxWeight_log\", \"maxLength_log\",\"commonLength_log\",\n                             \"Reproductive_Season\",\"Reproductive_strategy\",\n                             \"Sexual_differentation\",\"Migration\",\"Reproduction_location\",\n                             \"Shooling_type\",\"pop_double\")]\n\n\n\n\n\n\n\n\n",
    "created" : 1495517009756.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1104830226",
    "id" : "59BDE332",
    "lastKnownWriteTime" : 1495522859,
    "last_content_update" : 1495522862645,
    "path" : "C:/Users/miree/OneDrive/OneDrive - Victoria University of Wellington - STAFF/TropicGroupClassification/R/data_prep.R",
    "project_path" : "R/data_prep.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}